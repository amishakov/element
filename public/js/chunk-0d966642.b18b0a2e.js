(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d966642"],{1006:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"em-matrix"},["detail"==e.view?a("div",{staticClass:"em-matrix-table"},[e.tableHead.length?a("div",{staticClass:"em-matrix-row-head"},[e._l(e.tableHead,(function(t){return a("div",{staticClass:"em-matrix-head-field"},[a("span",{staticClass:"em-matrix-field__content"},[e._v(e._s(t))])])})),a("div",{staticClass:"em-matrix-head-field em-matrix-head-field__remove"})],2):e._e(),e._l(e.fieldValue.matrixValue,(function(t,i){return a("div",{staticClass:"em-matrix-row"},[e._l(t,(function(t){return a("div",{staticClass:"em-matrix-field em-matrix-field__name"},[a("span",{staticClass:"em-matrix-field__content"},[e._v(e._s(t.value))])])})),a("div",{staticClass:"em-matrix-field__hover-btns"},[a("div",{staticClass:"em-matrix-field em-matrix-field__edit",on:{click:function(a){return e.popupForEditMatrixColumn(t,i)}}},[e._v(e._s(e.$t("edit")))]),a("div",{staticClass:"em-matrix-field em-matrix-field__remove",on:{click:function(a){return e.removeElement({tableCode:e.fieldSettings.nodeTableCode,selectedElement:t})}}},[e._v(e._s(e.$t("remove")))])])],2)})),a("div",{staticClass:"em-matrix-row-add"},[a("div",{staticClass:"em-matrix-row-add__icon"},[a("svg",{attrs:{width:"9",height:"9"}},[a("use",{attrs:{"xlink:href":"#plus-gray"}})])]),a("div",{staticClass:"em-matrix-row-add__text",on:{click:function(t){return e.popupForCreateMatrixElement()}}},[e._v("\n\t\t\t\tNew\n\t\t\t")])])],2):a("div",[e._v("\n\t\t...\n\t")]),a("DetailPopup",{attrs:{visible:e.showDetail,tableCode:e.detailTableCode,name:e.detailName,id:e.detailTableId,element:e.currentElement},on:{"update:visible":function(t){e.showDetail=t},saveElement:e.saveElement,removeElement:e.removeElement,createElement:e.createElement}})],1)},n=[],s=(a("96cf"),a("3b8d")),l=a("a745"),r=a.n(l);function o(e){if(r()(e))return e}var c=a("5d73"),d=a.n(c),u=a("c8bb"),m=a.n(u);function f(e,t){if(m()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],i=!0,n=!1,s=void 0;try{for(var l,r=d()(e);!(i=(l=r.next()).done);i=!0)if(a.push(l.value),t&&a.length===t)break}catch(o){n=!0,s=o}finally{try{i||null==r["return"]||r["return"]()}finally{if(n)throw s}}return a}}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function v(e,t){return o(e)||f(e,t)||h()}a("ac4d"),a("8a81"),a("ac6a");var p=a("4328"),b=a.n(p),E=a("2520"),C={data:function(){return{showDetail:!1,detailTableCode:!1,detailTableId:!1,detailName:!1,currentElement:!1,detailElement:{}}},components:{DetailPopup:E["a"]},props:["fieldValue","fieldSettings","mode","view"],computed:{tableHead:function(){if("undefined"==typeof this.fieldValue.matrixValue)return[];var e=[];for(var t in this.fieldValue.matrixValue[0])e.push(t);return e}},methods:{updateMatrixTableElement:function(e){var t=this.$store.getters.getPrimaryKeyCode(this.fieldSettings.nodeTableCode),a=!0,i=!1,n=void 0;try{for(var s,l=this.fieldValue.matrixValue.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var r=v(s.value,2),o=r[0],c=r[1];if(+c[t].value==+e[t].value)return this.fieldValue.matrixValue[o]=e}}catch(d){i=!0,n=d}finally{try{a||null==l.return||l.return()}finally{if(i)throw n}}},createMatrixTableElement:function(e){"undefined"==typeof this.fieldValue.matrixValue&&this.$set(this.fieldValue,"matrixValue",[]);this.$store.getters.getPrimaryKeyCode(this.fieldSettings.nodeTableCode);this.fieldValue.matrixValue.push(e)},removeMatrixTableElement:function(e){var t=this.$store.getters.getPrimaryKeyCode(this.fieldSettings.nodeTableCode),a=!0,i=!1,n=void 0;try{for(var s,l=this.fieldValue.matrixValue.entries()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var r=v(s.value,2),o=r[0],c=r[1];if(+c[t].value==+e[t].value)return this.fieldValue.matrixValue.splice(o,1)}}catch(d){i=!0,n=d}finally{try{a||null==l.return||l.return()}finally{if(i)throw n}}},popupForEditMatrixColumn:function(e,t){this.currentElement=!1;var a=this.$store.getters.getPrimaryKeyCode(this.fieldSettings.nodeTableCode);this.detailTableId=e[a].value,this.detailTableCode=this.fieldSettings.nodeTableCode,this.detailName=!1,this.showDetail=!0},bindDefaultColumnValues:function(){this.currentElement=[];var e=this.$store.getters.getTable(this.fieldSettings.nodeTableCode);for(var t in e.columns)this.currentElement[t]={value:""};this.currentElement[this.fieldSettings.nodeField]={value:this.detailElement[this.fieldSettings.keyField].value}},popupForCreateMatrixElement:function(){this.bindDefaultColumnValues(),this.detailTableCode=this.fieldSettings.nodeTableCode,this.detailName="tableAddElement",this.showDetail=!0},saveElement:function(e){var t=this;this.$store.dispatch("saveSelectedElement",e).then((function(){t.updateMatrixTableElement(e.selectedElement),t.ElMessage(t.$t("elMessages.element_saved")),t.showDetail=!1}))},createElement:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,s,l,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=this.$store.getters.getPrimaryKeyCode(t.tableCode),i=[],n=[],e.t0=regeneratorRuntime.keys(t.selectedElement);case 4:if((e.t1=e.t0()).done){e.next=12;break}if(s=e.t1.value,a!=s){e.next=8;break}return e.abrupt("continue",4);case 8:i.push(s),n.push(t.selectedElement[s].value),e.next=4;break;case 12:return l=b.a.stringify({insert:{table:t.tableCode,columns:i,values:n}}),e.next=15,this.$axios.post("/el/insert/",l);case 15:r=e.sent,1==r.data.success?(t.selectedElement[a].value=r.data.lastid,this.createMatrixTableElement(t.selectedElement),this.ElMessage(this.$t("elMessages.element_created")),this.showDetail=!1):this.ElMessage.error(this.$t("elMessages.cant_create_element"));case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),removeElement:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var a,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.$store.getters.getPrimaryKeyCode(t.tableCode),e.next=3,this.$store.dispatch("removeRecord",{delete:{table:t.tableCode,where:{operation:"and",fields:[{code:a,operation:"IS",value:t.selectedElement[a].value}]}}}).then((function(){i.showDetail=!1,i.ElMessage(i.$t("elMessages.element_removed")),i.removeMatrixTableElement(t.selectedElement)}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.detailElement=Object.assign(this.$store.state.tables.selectedElement,{})}},g=C,_=(a("6d7a"),a("2877")),x=Object(_["a"])(g,i,n,!1,null,null,null);t["default"]=x.exports},"16cd":function(e,t,a){"use strict";var i=a("e7ba"),n=a.n(i);n.a},"1af6":function(e,t,a){var i=a("63b6");i(i.S,"Array",{isArray:a("9003")})},2520:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail-popup"},[a("Popup",{attrs:{visible:e.isPopupVisible},on:{"update:visible":function(t){e.isPopupVisible=t}}},[a("Detail",{attrs:{tableCode:e.tableCode,name:e.name,id:e.id,element:e.element},on:{cancel:e.cancel,openDetail:e.openDetail,saveElement:e.saveElement,removeElement:e.removeElement,createElement:e.createElement}})],1)],1)},n=[],s=a("b97e"),l={props:["tableCode","name","id","visible","element"],components:{Detail:s["a"]},computed:{isPopupVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{cancel:function(){this.isPopupVisible=!1},openDetail:function(e){this.$emit("openDetail",e)},saveElement:function(e){this.$emit("saveElement",e)},removeElement:function(e){this.$emit("removeElement",e)},createElement:function(e){this.$emit("createElement",e)}}},r=l,o=(a("16cd"),a("2877")),c=Object(o["a"])(r,i,n,!1,null,null,null);t["a"]=c.exports},"469f":function(e,t,a){a("6c1c"),a("1654"),e.exports=a("7d7b")},4988:function(e,t,a){},"54a1":function(e,t,a){a("6c1c"),a("1654"),e.exports=a("95d5")},"5d73":function(e,t,a){e.exports=a("469f")},"6d7a":function(e,t,a){"use strict";var i=a("8975"),n=a.n(i);n.a},"7d7b":function(e,t,a){var i=a("e4ae"),n=a("7cd6");e.exports=a("584a").getIterator=function(e){var t=n(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},"851c":function(e,t,a){"use strict";var i=a("4988"),n=a.n(i);n.a},8975:function(e,t,a){},"95d5":function(e,t,a){var i=a("40c3"),n=a("5168")("iterator"),s=a("481b");e.exports=a("584a").isIterable=function(e){var t=Object(e);return void 0!==t[n]||"@@iterator"in t||s.hasOwnProperty(i(t))}},a745:function(e,t,a){e.exports=a("f410")},b97e:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail"},[i("div",{staticClass:"detail-head"},[i("div",{staticClass:"detail-head-name"},[i("div",{staticClass:"detail-icon-wrapper"},[i("svg",{attrs:{width:"14",height:"13"}},[i("use",{attrs:{"xlink:href":"#tableicon"}})])]),"tableAddElement"!=e.name?[i("div",{staticClass:"detail-name-wrapper"},[i("div",{staticClass:"detail-head-label"},[e._v(e._s(e.$t("pages.table.edit_element")))]),i("div",{staticClass:"detail-head-descr"},[e._v(e._s(e.tableCode))])]),i("div",{staticClass:"detail-head__buttons"},[i("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),i("button",{staticClass:"el-gbtn",on:{click:e.remove}},[e._v(e._s(e.$t("remove")))]),i("button",{staticClass:"el-btn",on:{click:e.saveElement}},[e._v(e._s(e.$t("save")))])])]:[i("div",{staticClass:"detail-name-wrapper"},[i("div",{staticClass:"detail-head-label"},[e._v(e._s(e.$t("pages.table.new_element")))]),i("div",{staticClass:"detail-head-descr"},[e._v(e._s(e.tableCode))])]),i("div",{staticClass:"detail-head__buttons"},[i("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),i("button",{staticClass:"el-btn",on:{click:e.createElement}},[e._v(e._s(e.$t("create")))])])]],2)]),i("div",{staticClass:"detail-feilds"},e._l(e.selectedElement,(function(t,n){return i("div",{staticClass:"detail-feild"},[i("div",{staticClass:"detail-field__name-wrap"},[i("img",{staticClass:"detail-field__icon-image",attrs:{src:a("53a4")("./assets"+e.columnEmSettings(n).type_info.iconPath)}}),i("div",{staticClass:"detail-field-name"},[i("span",[e._v(e._s(e.getColumnName(n)))]),i("small",[e._v(e._s(n))])])]),i("div",{staticClass:"detail-field-box"},[i("MainField",{attrs:{mode:"edit",view:"detail",fieldName:t.fieldName,params:{value:t.value,settings:e.$store.getters.getColumnSettings(e.tableCode,n,e.selectedElement)}},on:{onChange:e.changeFieldValue}})],1)])})),0)])},n=[],s=(a("7f7f"),a("96cf"),a("3b8d")),l=a("6e3e"),r=(a("4328"),{props:["tableCode","name","id","element"],components:{MainField:l["a"]},data:function(){return{columns:{},selectedElement:{}}},mounted:function(){this.selectElement()},methods:{selectElement:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t={select:{},where:[],order:[]},t.select.from=this.tableCode,a=this.$store.getters.getPrimaryKeyCode(this.tableCode),this.columns=this.$store.getters.getColumns(this.tableCode),"tableAddElement"==this.name||this.element){e.next=11;break}return t.select.where={operation:"and",fields:[{code:a,operation:"IS",value:this.id}]},e.next=8,this.$store.dispatch("selectElement",t);case 8:this.selectedElement=this.$store.state.tables.selectedElement,e.next=12;break;case 11:for(i in this.columns)this.$set(this.selectedElement,i,{value:"",fieldName:this.columns[i].em.type_info.code}),this.element&&this.$set(this.selectedElement[i],"value",this.element[i].value);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changeFieldValue:function(e){this.selectedElement[e.settings.fieldCode].value=e.value},columnEmSettings:function(e){if("undefined"!=typeof this.columns[e])return this.columns[e].em;throw new Error("No column with code ".concat(e))},getColumnName:function(e){return this.columnEmSettings(e).name?this.columnEmSettings(e).name:e},saveElement:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$emit("saveElement",{selectedElement:this.selectedElement,tableCode:this.tableCode});case 2:this.selectElement();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),createElement:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$emit("createElement",{selectedElement:this.selectedElement,tableCode:this.tableCode});case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),cancel:function(){this.$emit("cancel")},remove:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$emit("removeElement",{selectedElement:this.selectedElement,tableCode:this.tableCode});case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}),o=r,c=(a("851c"),a("2877")),d=Object(c["a"])(o,i,n,!1,null,null,null);t["a"]=d.exports},c8bb:function(e,t,a){e.exports=a("54a1")},e7ba:function(e,t,a){},f410:function(e,t,a){a("1af6"),e.exports=a("584a").Array.isArray}}]);
//# sourceMappingURL=chunk-0d966642.b18b0a2e.js.map